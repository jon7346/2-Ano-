CREATE DATABASE BD_FILMES_JOIN;
USE BD_FILMES_JOIN;

CREATE TABLE FILME(
	ID INT PRIMARY KEY NOT NULL,
	TITULO VARCHAR(100),
	ANO_LANCAMENTO INT,
	DURACAO_MIN INT,
	CLASSIFICACAO_ETARIA VARCHAR(10)
);

CREATE TABLE GENERO(
	ID INT PRIMARY KEY NOT NULL,
	NOME VARCHAR(50)
);

CREATE TABLE ATOR(
	ID INT PRIMARY KEY NOT NULL,
	NOME VARCHAR(100),
	NACIONALIDADE VARCHAR(50),
	DATA_NASCIMENTO DATE
);

CREATE TABLE FILME_GENERO(
	ID INT PRIMARY KEY NOT NULL,
	FILMEID INT,
	GENEROID INT,
	FOREIGN KEY(FILMEID) REFERENCES FILME(ID),
	FOREIGN KEY(GENEROID) REFERENCES GENERO(ID)
);

CREATE TABLE FILME_ATOR(
	ID INT PRIMARY KEY NOT NULL,
	FILMEID INT,
	ATORID INT,
	PAPEL VARCHAR(100),
	FOREIGN KEY(FILMEID) REFERENCES FILME(ID),
	FOREIGN KEY(ATORID) REFERENCES ATOR(ID)
);

GO

-- Inserção de filmes
INSERT INTO FILME VALUES (1, 'A Origem', 2010, 148, '14');
INSERT INTO FILME VALUES (2, 'Matrix', 1999, 136, '16');
INSERT INTO FILME VALUES (3, 'O Senhor dos Anéis', 2001, 178, '12');
INSERT INTO FILME VALUES (4, 'Titanic', 1997, 195, '12');
INSERT INTO FILME VALUES (5, 'Toy Story', 1995, 81, 'L');
INSERT INTO FILME VALUES (6, 'Interestelar', 2014, 169, '12');
INSERT INTO FILME VALUES (7, 'Homem de Ferro', 2008, 126, '12');
INSERT INTO FILME VALUES (8, 'A Bela e a Fera', 2017, 129, '10');


-- Inserção de gêneros
INSERT INTO GENERO VALUES (1, 'Ação');
INSERT INTO GENERO VALUES (2, 'Ficção Científica');
INSERT INTO GENERO VALUES (3, 'Aventura');
INSERT INTO GENERO VALUES (4, 'Romance');
INSERT INTO GENERO VALUES (5, 'Animação');

-- Inserção de atores
INSERT INTO ATOR VALUES (1, 'Leonardo DiCaprio', 'Estados Unidos', '1974-11-11');
INSERT INTO ATOR VALUES (2, 'Keanu Reeves', 'Canadá', '1964-09-02');
INSERT INTO ATOR VALUES (3, 'Tom Hanks', 'Estados Unidos', '1956-07-09');
INSERT INTO ATOR VALUES (4, 'Elijah Wood', 'Estados Unidos', '1981-01-28');
INSERT INTO ATOR VALUES (5, 'Joseph Gordon-Levitt', 'Estados Unidos', '1981-02-17');
INSERT INTO ATOR VALUES (6, 'Emma Watson', 'Reino Unido', '1990-04-15');
INSERT INTO ATOR VALUES (7, 'Will Smith', 'Estados Unidos', '1968-09-25');
INSERT INTO ATOR VALUES (8, 'Scarlett Johansson', 'Estados Unidos', '1984-11-22');


-- Inserção de filme-gênero (relacionamentos)
INSERT INTO FILME_GENERO VALUES (1, 1, 1); -- A Origem - Ação
INSERT INTO FILME_GENERO VALUES (2, 1, 2); -- A Origem - Ficção Científica
INSERT INTO FILME_GENERO VALUES (3, 2, 1); -- Matrix - Ação
INSERT INTO FILME_GENERO VALUES (4, 2, 2); -- Matrix - Ficção Científica
INSERT INTO FILME_GENERO VALUES (5, 3, 3); -- O Senhor dos Anéis - Aventura
INSERT INTO FILME_GENERO VALUES (6, 4, 4); -- Titanic - Romance
INSERT INTO FILME_GENERO VALUES (7, 5, 5); -- Toy Story - Animação
INSERT INTO FILME_GENERO VALUES (8, 6, NULL); -- Interestelar
INSERT INTO FILME_GENERO VALUES (9, 7, NULL); -- Homem de Ferro
INSERT INTO FILME_GENERO VALUES (10, 8, NULL); -- A Bela e a Fera
INSERT INTO FILME_GENERO VALUES (11, 8, NULL); -- A Bela e a Fera (outro gênero não especificado)


-- Inserção de filme-ator (relacionamentos)
INSERT INTO FILME_ATOR VALUES (1, 1, 5, 'Arthur');
INSERT INTO FILME_ATOR VALUES (2, 1, 1, 'Cobb');
INSERT INTO FILME_ATOR VALUES (3, 2, 2, 'Neo');
INSERT INTO FILME_ATOR VALUES (4, 3, 4, 'Frodo');
INSERT INTO FILME_ATOR VALUES (5, 4, 1, 'Jack Dawson');
INSERT INTO FILME_ATOR VALUES (6, 5, 3, 'Woody');
INSERT INTO FILME_ATOR VALUES (7, 6, NULL, 'Cooper');
INSERT INTO FILME_ATOR VALUES (8, 7, NULL, 'Tony Stark');
INSERT INTO FILME_ATOR VALUES (9, 8, NULL, 'Bela');
INSERT INTO FILME_ATOR VALUES (10, 6, NULL, 'Murph');]


SELECT * FROM FILME; 
SELECT * FROM ATOR; 
SELECT * FROM FILME_ATOR; 
SELECT * FROM FILME_GENERO; 
SELECT * FROM GENERO; 

-- inner join quando as tabelas tem relação entre si 

-- outer join retorna dados quando as tabelas não são relacionadas 


--junções 
-- EXEMPLO sem JOIN (notação implicita  )

SELECT * FROM FILME, ATOR, FILME_ATOR WHERE ATORID = FILME_ATOR.ATORID AND FILME.ID = FILME_ATOR.FILMEID;


SELECT * FROM ATOR A 
INNER JOIN FILME_ATOR FA ON  ATORID = FA.ATORID 
INNER JOIN FILME F  ON F.ID = FA.FILMEID; 

/*
SELECT <COLUNAS> 
FROM <TABELAS> 
INNER JOIN <TABELA2> ON <TABLEAS1>.<COLUNAS > = <TABELAS2>.<COLUNAS>; 
*/

--TO DO: JUNTAR AS TABELAS FILME_ATOR E ATOR COM O PONTO DE JUNÇÃO ATORID 

SELECT * FROM FILME_ATOR FA
INNER  JOIN ATOR A ON A.ID = FA.ATORID

-- LEFT JOIN 
/*
Retorna dados da tabela á esquerda mesmo que não haja correspondencia na da direita					
*/ 

SELECT * FROM FILME_ATOR FA LEFT JOIN ATOR A ON FA.ATORID = A.ID;

-- lEFT JOIN EXCLUINDO A CORRESPONDENCIA -- 

-- Essa consulta retorna apenas os registros de FILME_ATOR Onde não 
-- há correspondência na tabela ATOR (somente o que é excluido )


SELECT * FROM FILME_ATOR FA LEFT JOIN ATOR A ON FA.ATORID = A.ID WHERE A.ID IS NULL;
-- RIGHT JOIN -- 

-- Retorna dados á direita, meSmo quando não houver correspondência 
--na tabela á esquerda 
SELECT * FROM FILME_ATOR FA RIGHT JOIN ATOR A ON FA.ATORID = A.ID; 

-- RIGHT JOIN excluindo correspondências 

SELECT * FROM FILME_ATOR FA RIGHT JOIN ATOR A ON FA.ATORID = A.ID WHERE ATORID IS NULL;

-- FULL JOIN 

-- Combinação do LEFT JOIN com  RIGHT JOIN 
-- TODOS os registros que possuem correspondência ou não 

SELECT * FROM FILME_ATOR FA FULL JOIN ATOR A ON A.ID = FA.ATORID;

-- FULL JOIN EXCLUINDO OS DADOS NULOS 

SELECT * FROM FILME_ATOR FA FULL JOIN ATOR A ON A.ID = FA.ATORID WHERE FA.ID IS NULL OR A.ID IS NULL; 

-- 06/06/2025

--1) Obtenha a produtos (código e nome) com suas categorias(nome) e fornecedores(nomes).
SELECT PR.IDPRODUTO, PR.NOMEPRODUTO, CAT.NOMECATEGORIA, FO.NOMEFORNECEDOR FROM PRODUTOS PR FULL JOIN CATEGORIAS CAT ON CAT.IDCATEGORIA = PR.IDCATEGORIA FULL JOIN FORNECEDORES FO ON FO.IDFORNECEDOR = PR.IDFORNECEDOR;
--2)Obtenha os Clientes (Nome da empresa) com funcionário responsável (nome e sobrenome) e data da venda 
SELECT CL.NOMEEMPRESA, FU.NOME, FU.SOBRENOME, VD.DATAVENDA FROM CLIENTES CL INNER JOIN VENDAS VD ON CL.IDCLIENTE = VD.IDCLIENTE INNER JOIN FUNCIONARIOS FU ON  VD.IDFUNCIONARIO = FU.IDFUNCIONARIO;
--3) Obtenha detalhes das vendas com nome do produto, quantidade vendida e total (preço unitário x qtd)
SELECT PR.NOMEPRODUTO, VDD.QUANTIDADE,(VDD.PRECOUNITARIO*VDD.QUANTIDADE) FROM PRODUTOS PR JOIN VENDADETALHES VDD ON PR.IDPRODUTO = VDD.IDPRODUTO; 
-- 4) Listar todos os funcionarios (nome e sobrenome) e, se houver, os territórios aos quais estão associados. Casos algum funcinário não tenha terrítorio atribuído, ainda assim ele deve aparecer na lista 
SELECT NOME, SOBRENOME, TR.IDTERRITORIO FROM FUNCIONARIOS FU FULL JOIN FUNCIONARIOSTERRITORIOS FT ON FU.IDFUNCIONARIO = FT.IDFUNCIONARIO FULL JOIN TERRITORIOS TR ON FT.IDTERRITORIO = TR.IDTERRITORIO WHERE NOME IS NOT NULL   ;
-- 5) obtenha os produtos que nunca foram vendidos 

SELECT NOMEPRODUTO, IDVENDA FROM PRODUTOS PR FULL JOIN VENDADETALHES VD ON PR.IDPRODUTO = VD.IDPRODUTO WHERE IDVENDA IS NULL;
-- 6) elabore um requisito (enunciado e resposta) para cada operador: INNER JOIN, LEFT JOIN, LEFT JOIN EXCLUDENTE, RIGHT JOIN, RIGHT JOIN EXCLUDENTE, FULL JOIN E FULL JOIN EXCLUDENTE. 

--FULL JOIN
-- Listar nome do produto e quantidade de vendas

SELECT NOMEPRODUTO, SUM(QUANTIDADE) AS TOTAL FROM PRODUTOS PR FULL JOIN VENDADETALHES VD ON PR.IDPRODUTO = VD.IDPRODUTO GROUP BY NOMEPRODUTO;

-- RIGHT JOIN
-- listar territorios e nome dos funcionarios mesmo se não houver um correspondente 

SELECT TR.IDTERRITORIO, FU.NOME FROM TERRITORIOS TR RIGHT JOIN FUNCIONARIOSTERRITORIOS FT ON FT.IDTERRITORIO = TR.IDTERRITORIO FULL JOIN FUNCIONARIOS FU ON FU.IDFUNCIONARIO = FT.IDFUNCIONARIO;

-- LEFT JOIN
-- Listar todos os produtos e o numero de vendas mesmo se não tiveren sido contados 

SELECT NOMEPRODUTO, COUNT(IDVENDA) FROM PRODUTOS PR LEFT JOIN VENDADETALHES VDD ON  VDD.IDPRODUTO = PR.IDPRODUTO GROUP BY NOMEPRODUTO ;


-- INNER JOIN 
--Listar produtos e detalhes das suas vendas 
SELECT * FROM PRODUTOS PR INNER JOIN VENDADETALHES VDD ON PR.IDPRODUTO = VDD.IDPRODUTO;

-- FULL JOIN EXCLUDED
-- liStar o numero de produtos desconto maior que 20 centavos

SELECT NOMEPRODUTO, DESCONTO FROM PRODUTOS FULL JOIN VENDADETALHES ON VENDADETALHES.IDPRODUTO = PRODUTOS.IDPRODUTO WHERE DESCONTO > 0.2;

-- LEFT JOIN EXCLUDED 
-- listar produtos e todos os dados do fornecedor e excluir possuem fax e website

SELECT NOMEPRODUTO, FAX, NOMEFORNECEDOR, TELEFONE, WEBSITE FROM PRODUTOS LEFT JOIN FORNECEDORES ON PRODUTOS.IDFORNECEDOR = FORNECEDORES.IDFORNECEDOR WHERE WEBSITE IS NULL;

-- RIGTH JOIN EXCLUDED 
-- listar produtos e os detalhes de suas vendas memsmo se eles nunca foram vendidos e mostrar apenas os que tem o valor unitário acima de 10,00 
SELECT nomeproduto, VendaDETALHES.* FROM PRODUTOS RIGHT JOIN VENDADETALHES ON VENDADETALHES.IDPRODUTO = PRODUTOS.IDPRODUTO WHERE PRODUTOS.PRECOUNITARIO > 10.00;


-- INNER JOIN EXCLUDED 
-- quero tudo sobre produtos e suas todos os detalhes da suas vendas e se elas estão prsentes nas duas tabelas
SELECT * FROM PRODUTOS INNER JOIN VENDADETALHES ON PRODUTOS.IDPRODUTO = VENDADETALHES.IDPRODUTO INNER JOIN VENDAS ON VENDAS.IDVENDA = VENDADETALHES.IDVENDA WHERE VENDAS.idvenda <> VENDADETALHES.IDVENDA;