CREATE DATABASE BD_FILMES;
USE BD_FILMES;

CREATE TABLE FILME(
	ID INT PRIMARY KEY NOT NULL,
	TITULO VARCHAR(100),
	ANO_LANCAMENTO INT,
	DURACAO_MIN INT,
	CLASSIFICACAO_ETARIA VARCHAR(10)
);

CREATE TABLE GENERO(
	ID INT PRIMARY KEY NOT NULL,
	NOME VARCHAR(50)
);

CREATE TABLE ATOR(
	ID INT PRIMARY KEY NOT NULL,
	NOME VARCHAR(100),
	NACIONALIDADE VARCHAR(50),
	DATA_NASCIMENTO DATE
);

CREATE TABLE FILME_GENERO(
	ID INT PRIMARY KEY NOT NULL,
	FILMEID INT,
	GENEROID INT,
	FOREIGN KEY(FILMEID) REFERENCES FILME(ID),
	FOREIGN KEY(GENEROID) REFERENCES GENERO(ID)
);

CREATE TABLE FILME_ATOR(
	ID INT PRIMARY KEY NOT NULL,
	FILMEID INT,
	ATORID INT,
	PAPEL VARCHAR(100),
	FOREIGN KEY(FILMEID) REFERENCES FILME(ID),
	FOREIGN KEY(ATORID) REFERENCES ATOR(ID)
);

INSERT INTO FILME VALUES (1, 'A Origem', 2010, 148, '14' );
INSERT INTO FILME VALUES (2,'Matrix', 1999, 136, '16'); 
INSERT INTO FILME VALUES (3,'O Senhor dos anèis', 2001, 178, '12');
INSERT INTO FILME VALUES (4,'Titanic', 1997, 195, '12');
INSERT INTO FILME VALUES (5,'toy Story', 1995, 81, 'L');

INSERT INTO GENERO VALUES (1, 'AÇÃO');
INSERT INTO GENERO VALUES (2, 'FICÇÃO CIENTIFICA');
INSERT INTO GENERO VALUES (3, 'AVENTURA');
INSERT INTO GENERO VALUES (4, 'ROMANCE');
INSERT INTO GENERO VALUES (5, 'ANIMAÇÃO');

INSERT INTO ATOR VALUES (1, 'Leonardo DiCaprio', 'Estados Unidos', '1974-11-11' );
INSERT INTO ATOR VALUES(2, 'Keanu Reeves', 'Canadá', '1964-09-02');
INSERT INTO ATOR VALUES(3, 'Tom Hanks', 'Estados Unidos', '1956-07-09');
INSERT INTO ATOR VALUES(4, 'Eliajah Wood', 'Estados Unidos', '1981-01-28');
INSERT INTO ATOR VALUES(5, 'Joseph Gordon-Levitt','Estados Unidos', '1981-02-17');

INSERT INTO FILME_GENERO VALUES(1, 1 , 1); -- A Origem - Ação
INSERT INTO FILME_GENERO VALUES(2, 1, 2); --A Origem - Ficção Cientifica
INSERT INTO FILME_GENERO VALUES(3,2,1); --Matrix - Ação
INSERT INTO FILME_GENERO VALUES(4,2,2); --Matrix - Ficção Cientifica
INSERT INTO FILME_GENERO VALUES(5,3,3); -- O Senhor dos Anéis - Aventura 
INSERT INTO FILME_GENERO VALUES(6, 4, 4); -- Titanic -Romance
INSERT INTO FILME_GENERO VALUES(7, 5, 5); -- Toy Story - Animação

INSERT INTO FILME_ATOR VALUES(1,1,5, 'Arthur'); 
INSERT INTO FILME_ATOR VALUES(2,1,1, 'Cobb');
INSERT INTO FILME_ATOR VALUES(3,2,2, 'Neo');
INSERT INTO FILME_ATOR VALUES(4,3,4, 'Frodo'); 
INSERT INTO FILME_ATOR VALUES(5,4,1, 'Jack Dawson'); 
INSERT INTO FILME_ATOR VALUES(6,5,3, 'Woody');

SELECT * FROM FILME;
SELECT * FROM GENERO; 
SELECT * FROM ATOR; 
SELECT * FROM FILME_GENERO
SELECT * FROM FILME_ATOR

--	DDL - LINGUAGEM DE CONSULTA DE DADOS 
-- 1. OBTENHA O TITULO DDE TODOS OS FILMES 
SELECT TITULO FROM FILME;
 -- 2. OBTENHA O NOME E CÓDIGO DOS ATORES DO ESTADOS UNIDOS 
SELECT ID, NOME FROM ATOR WHERE NACIONALIDADE = 'Estados Unidos'; 

-- 3. Obtenha o nome e a duração em horas(duração_min/60) de cada filme 
SELECT TITULO,(DURACAO_MIN/60) AS DURAÇÃO_HORAS FROM FILME; 
-- APLICAR MELHORIA PARA APRESENTAR VALOR DECIMAL 
SELECT TITULO, CAST(DURACAO_MIN/60AS DECIMAL (10,2)) AS DURAÇAO_HORAS FROM FILME;

--4. Obtenha o nome dos Filmes com duração menor que 120 minutos
SELECT TITULO FROM FILME WHERE DURACAO_MIN < 120;  

--5. Obtenha os nomes dos filmes lançados após 1997
-- com classificação étaria 14

SELECT * fROM FILME WHERE ANO_LANCAMENTO > 1997 AND CLASSIFICACAO_ETARIA > 14 ; 

--6) Obtenha o código dos atores que participaram do filme 5 (toy story)

SELECT ATORID FROM FILME_ATOR WHERE FILMEID = 5; 

--7) Obtenha o código dos atores que atuaram no mesmo filme com outros atores (ou seja com mais de um ator )

SELECT FA1.* FROM FILME_ATOR AS FA1, FILME_ATOR AS FA2;

SELECT FA1.*, FA2.* -- SELECIONOU OS ELEMENTOS FA1 E FA2 
FROM FILME_ATOR AS FA1, FILME_ATOR AS FA2  --CRIANDO OS FA1 E FA2 
WHERE FA1.FILMEID = FA2.FILMEID -- DEFININDO QUE DEVE MOSTRAR OS ATORES APENAS DE FILMES IGUAIS (COM MESMO IDS )
AND  FA1.ATORID <> FA2. ATORID; -- DEFININDO 

--8. OBTENHA O CÓDIGO DOS FILMES QUE TÊM A MESMA FAIXA ETARIA 
SELECT FA1.ID FROM FILME AS FA1, FILME AS FA2 WHERE FA1.CLASSIFICACAO_ETARIA = FA2.CLASSIFICACAO_ETARIA AND FA1.ID <> FA2.ID;
-- DQL - Operador UPPER 

-- O OPERADOR OPPER SERVE PARA COLOCAR EM MAIÚSCULO TODAS AS LETRAS DE UMA DETERMINADA 

--9. OBTENHA O TITULO(CAIXA ALTA) E A DURAÇÃO DO FILME COM CÓDIGO = 1 
SELECT UPPER(TITULO) AS TITULO, DURACAO_MIN FROM FILME WHERE ID = 1;

--10. OBTENHA O TÍTULO DOS FILMES COM DURAÇÃO ENTRE 120 E 180 MINUTOS 
SELECT * FROM FILME WHERE DURACAO_MIN BETWEEN 120 AND 180;

-- DQL - Operador IN testa os valores da coluna 
-- 11. Obtenha o titulo dos filmes com classificação etária '12' ou '16' e com duração de 90, 136, 178 ou 195 minutos  

	SELECT TITULO
	FROM FILME 
	WHERE( CLASSIFICACAO_ETARIA = '12' OR CLASSIFICACAO_ETARIA ='16')
	AND DURACAO_MIN IN (90,136,178,195);

	-- DQL - OPERADOR LIKE 
	-- OPERADOR LIKE PERMITE RECUPERAR LINHA DA TABELA SEM SABER EXTAMENTE O VALOR QUE ESTÁ SENDO PROCURADO, UTILIZANDO PARA ISSO OS SIMBOLOS (%) E (_)

	-- 12. OBTENHA O NOME DOS ATOES CUJA NACIONALODADE COMEÇA COM A LETRA 'E'
	SELECT * FROM ATOR WHERE NACIONALIDADE LIKE 'E%'; -- LIKE 'E%' SIGINIFICA COMEÇA COM E E O RESTO NÃO IMPORTA

	-- EXEMPLOS ADICIONAIS: 

	-- VALORES QUE COMEÇAM COM 'A'
	SELECT * FROM ATOR WHERE NACIONALIDADE LIKE 'A%';

	-- VALORES QUE TERMINAM COM 'A'
	SELECT * FROM ATOR WHERE NACIONALIDADE LIKE '%A';
	
	-- VALOES QUE CONTÉM 'NAD' EM QUALQUER POSIÇÃO
	SELECT * FROM ATOR WHERE NACIONALIDADE LIKE '%NAD%'; 
	
	-- VALORES QUE CONTÉM UM 'S' NA SEGUNDA POSIÇÃO
	SELECT * FROM ATOR WHERE NACIONALIDADE LIKE '_S%';
	
	--CRIE MAIS 4 EXEMPLOS COM TABELAS VARIADAS 


	-- FILMES QUE COMEÇAM COM T 
	SELECT * FROM FILME WHERE TITULO LIKE 'T';

	-- FILMES QUE CONTÉM DUAS PALAVRAS NO TITULO OU QUE CONTÉM ESPAÇO 
	SELECT * FROM FILME WHERE TITULO LIKE '% %';
	-- FILMES QUE CONTÉM A LETRA A NO SEU TITULO 
	SELECT * FROM FILME WHERE TITULO LIKE '%A%';
	-- GENERO QUE CONTÉM A LETRA E NO SEU NOME
	SELECT * FROM GENERO WHERE NOME LIKE '%E%';

	-- Operador is null 
	--13) Obtenha o titulo dos filmes que não possuem
	--classificação cadastra

	SELECT * FROM FILME;

	--SIMULAÇÃO
	UPDATE FILME SET CLASSIFICACAO_ETARIA = NULL WHERE ID= 1 ;
	

	SELECT TITULO, CLASSIFICACAO_ETARIA FROM FILME WHERE CLASSIFICACAO_ETARIA IS NULL; 

	--Operador NOT 
	-- Pode ser utilizado com: 
	/*
	pode ser utulizado com 
	not between 
	not in 
	not like 
	is not null

	
	*/
	--14) Obtenha o título dos filmes cuja duração não seja: 81, 136 ou 148 minutos. 
	SELECT * FROM FILME WHERE DURACAO_MIN NOT IN(81, 136, 148); 


	-- Operador DISTINCT: utilizado para eleminar valores duplicados na saída 
    --15) OBTENHA OS CÓDIGOS DOS FILMES QUE Têm atores associados
	SELECT DISTINCT FILMEID FROM FILME_ATOR;
	
	--16)Obtenha, em ordem decrescente de duração, os titulos dos filmes 
	-- com classifição etária '16' e duração maior que 100 minutos.

	SELECT TITULO, DURACAO_MIN FROM FILME WHERE CLASSIFICACAO_ETARIA = '12' AND DURACAO_MIN > 100 ORDER BY DURACAO_MIN DESC; 

	--GROUP BY	referencia uma coluna especificada da tabela na cláusula FROM e agrupa as linhas co base nos valores iguais dessa coluna.  
	--17)obtenha o ID do filme e a quantidade de atores participantes em cada filme
	SELECT FILMEID, COUNT(*) FROM FILME_ATOR GROUP BY FILMEID;
	--COUNT: retorna o número de ocorrência do filtro especificado 
	-- COM O TIULO DO FILME
	SELECT F.TITULO, COUNT(*) AS QTD_ATORES FROM FILME_ATOR FA, FILME F WHERE FA.FILMEID = F.ID GROUP BY F.TITULO;
	
	-- SUM : retorna a soma dos valores da coluna especificado
	SELECT * FROM FILME; 
	SELECT CLASSIFICACAO_ETARIA, SUM(DURACAO_MIN) AS TOTAL_MIN FROM FILME GROUP BY CLASSIFICACAO_ETARIA; 

	
	-- AVG: RETORNA A MÉDIA DOS VALORES DA COLUNA ESPECIFICADA 
	

	-- MAX: RETORNA O VALOR MAXIMO DE UMA COLUNA 
	-- MIN: RETORNA O VALOR MÍNIMO DE UMA COLUNA 

	SELECT MAX(DURACAO_MIN) AS MAIOR FROM FILME; 

	SELECT MIN(DURACAO_MIN) AS MENOR FROM FILME;

	-- A cláusula HAVING especifica uma restrição sobre a tabela agrupada que resultou de uma cláusula 
	-- GROUP BY anterior e elimina os grupos que não satisfazem a condição estabelicida


	--18) obtenha os códigos dos filmes com menos de 5 atores associados 
	 SELECT FILMEID, COUNT(*)
	 FROM FILME_ATOR 
	 GROUP BY FILMEID 
	 HAVING COUNT(*) < 5; 
	 -- Obter filmes com duração média menor que 150 minutos. 

	 SELECT * FROM FILME

		SELECT CLASSIFICACAO_ETARIA, AVG(DURACAO_MIN) AS MÉDIA FROM FILME  GROUP BY (CLASSIFICACAO_ETARIA) HAVING AVG(DURACAO_MIN) < 150;
